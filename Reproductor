<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="referrer" content="no-referrer">
  <meta http-equiv="cache-control" content="no-cache" />
  <meta http-equiv="expires" content="0" />
  <meta http-equiv="pragma" content="no-cache" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

  <style>
    #player {
      width: 100%;
      max-width: 800px;
      margin: auto;
      background-color: #000;
      box-shadow: 0 0 10px rgba(0,0,0,0.6);
    }

    .jwplayer { color: #fff !important; font-family: 'Segoe UI', sans-serif; }
    .jw-controlbar { background-color: rgba(20, 20, 20, 0.85) !important; border-top: 1px solid #333; }
    .jw-button-color { color: #ccc !important; }
    .jw-icon { filter: brightness(1.4); }
    .jw-text-track-display { background-color: rgba(0,0,0,0.6); color: #fff; font-size:16px; font-family:'Segoe UI',sans-serif; }
    .jw-title { color: #ddd !important; }
    .jw-display-icon-container { background-color: rgba(0,0,0,0.5); }

    .ios-landscape {
      transform: rotate(90deg);
      transform-origin: center center;
      width: 100vh !important;
      height: 100vw !important;
      position: fixed !important;
      top: 0;
      left: 0;
      background: #000;
      z-index: 9999;
    }
  </style>
</head>
<body>

<div id="player" allow="fullscreen; screen-orientation-lock"></div>

<!-- JWPlayer -->
<script src="https://ssl.p.jwpcdn.com/player/v/8.32.0/jwplayer.js"></script>

<script>
jwplayer.key = 'XSuP4qMl+9tK17QNb+4+th2Pm9AWgMO/cYH8CI0HGGr7bdjo';

function iniciarReproductor() {

  const hlsUrl = "https://el4live1.boldmss.com/CANAL_7_JUJUY/CANAL_7_JUJUY_EL4.isml/CANAL_7_JUJUY.m3u8";

  const player = jwplayer("player").setup({
    playlist: [{
      image: "",
      sources: [
        {
          default: true,
          type: "hls",
          file: hlsUrl,
          label: "HLS HD"
        }
      ]
    }],
    width: "100%",
    height: "100%",
    aspectratio: "16:9",
    autostart: true,
    mute: false,
    preload: "auto",

    live: {
      dvrSeekLimit: 3600,
      edgeMargin: 5
    },

    displaytitle: true,
    displaydescription: false
  });

  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
  const isSmartTV = /SmartTV|Tizen|Web0S|SmartHub|Chromecast/i.test(navigator.userAgent);

  // Audio Boost
  if (!isSmartTV) {
    player.on("play", function () {
      const video = document.querySelector("#player video");
      if (video && !video.audioBoostApplied) {
        try {
          const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
          const source = audioCtx.createMediaElementSource(video);
          const gain = audioCtx.createGain();
          gain.gain.value = 2;
          source.connect(gain);
          gain.connect(audioCtx.destination);
          video.muted = false;
          video.volume = 1.0;
          video.audioBoostApplied = true;
        } catch(e) { console.warn("Audio boost no disponible:", e); }
      }
    });
  }

  // SmartTV fallback
  if (isSmartTV) {
    player.on("ready", function () {
      const video = document.querySelector("#player video");
      if (video) { video.muted = false; try { video.volume = 1.0; } catch(e){} }
    });
  }

  // Auto selección de audio
  const lang = 1;
  player.on("play", () => player.setCurrentAudioTrack(lang));

  // ROTACIÓN AUTOMÁTICA
  player.on("fullscreen", function(e) {
    const contenedor = document.getElementById("player");

    if (!isIOS && screen.orientation) {
      if (e.fullscreen) {
        const tryLock = async () => {
          try { await screen.orientation.lock("landscape"); }
          catch(err) { setTimeout(tryLock, 200); }
        };
        tryLock();
      } else {
        try { screen.orientation.unlock(); } catch(err) {}
      }
    }

    if (isIOS) {
      if (e.fullscreen) contenedor.classList.add("ios-landscape");
      else contenedor.classList.remove("ios-landscape");
    }
  });

  // Baja de calidad si hay buffering
  player.on("buffer", function() {
    try { player.setCurrentQuality(0); } catch(e){}
  });

  // Log DVR
  player.on("ready", () => {
    const latency = player.getLiveLatency?.();
    console.log("Latencia / DVR:", latency, "segundos");
  });
}

window.onload = iniciarReproductor;
</script>

</body>
</html>
